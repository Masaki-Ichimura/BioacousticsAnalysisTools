#:kivy 2.1

<FrogDrawerItem@MDNavigationDrawerItem>
    icon_color: app.theme_cls.text_color
    theme_text_color: 'Custom'
    text_color: app.theme_cls.text_color
    selected_color: app.theme_cls.secondary_text_color

<FrogSeparateOptionTextField@MDTextField>
    font_size: '15sp'
    mode: 'rectangle'
    multiline: False
    helper_text_mode: 'persistent'
    text_color_normal: app.theme_cls.text_color
    line_color_normal: app.theme_cls.text_color
    disabled_foreground_color: app.theme_cls.secondary_text_color

<FrogTab>:
    title: 'カエル'

    BoxLayout:
        orientation: 'vertical'
        size: root.size
        pos: root.pos

        MDNavigationLayout:

            ScreenManager:
                id: screen_manager

                FrogSeparate:
                    id: separate
                    name: 'separate'
                    parent_tab: root

                FrogSelect:
                    id: select
                    name: 'select'
                    parent_tab: root

                FrogAnalysis:
                    id: analysis
                    name: 'analysis'
                    parent_tab: root

            MDNavigationDrawer:
                id: nav_drawer
                type: 'standard'
                pos: root.pos
                width: root.width*.25

                MDNavigationDrawerMenu:

                    FrogDrawerItem:
                        icon: 'call-split'
                        text: '音源分離'
                        on_press:
                            screen_manager.current = 'separate'
                            #nav_drawer.set_state('close')

                    MDNavigationDrawerLabel:
                        text: '▽'
                        padding: [dp(40), dp(5), 0, dp(5)]

                    FrogDrawerItem:
                        icon: 'check-bold'
                        text: 'カエル信号の選択'
                        on_press:
                            screen_manager.current = 'select'
                            #nav_drawer.set_state('close')

                    MDNavigationDrawerLabel:
                        text: '▽'
                        padding: [dp(40), dp(5), 0, dp(5)]

                    FrogDrawerItem:
                        icon: 'poll'
                        text: '同期解析'
                        on_press:
                            screen_manager.current = 'analysis'
                            #nav_drawer.set_state('close')

<FrogSeparate>:
    BoxLayout:
        orientation: 'horizontal'
        size: root.size

        MDBoxLayout:
            orientation: 'vertical'
            size_hint_x: 2
            spacing: dp(10)
            adaptive_width: True

            MDProgressBar:
                id: progressbar
                orientation: 'horizontal'
                size_hint_y: None
                # pos_hint: {"center_y": .6}
                # type: "indeterminate"

            # MDBoxLayout:
            #     orientation: 'horizontal'
            #     padding: dp(20), dp(10)
            #     spacing: dp(15)
            #     adaptive_height: True
            #
            #     MDIcon:
            #         icon: 'cog-outline'
            #         font_size: '20sp'
            #
            #     MDLabel:
            #         font_style: 'H5'
            #         text: 'Settings'

            MDSegmentedControl:
                id: mode_control
                radius: 0
                segment_color: 1, 1, 1, .4

                MDSegmentedControlItem:
                    text: 'ILRMA'

                MDSegmentedControlItem:
                    text: 'AuxIVA'

                MDSegmentedControlItem:
                    text: 'FastMNMF'

            ScreenManager:
                id: screen_manager
                transition: NoTransition()

                MDScreen:
                    name: 'ilrma'

                    MDStackLayout:
                        orientation: 'tb-lr'
                        padding: [dp(15), 0, dp(15), 0]
                        spacing: dp(20)

                        FrogSeparateOptionTextField:
                            id: ilrma_n_src
                            text: '1'
                            hint_text: 'number of sound source.'
                            helper_text: 'default: number of channel'

                        FrogSeparateOptionTextField:
                            id: ilrma_n_iter
                            text: '30'
                            hint_text: 'number of iteration.'
                            helper_text: 'default: 30'

                        FrogSeparateOptionTextField:
                            id: ilrma_n_components
                            text: '4'
                            hint_text: 'number of components in the non-negative spectrum.'
                            helper_text: 'default: 4'

                MDScreen:
                    name: 'auxiva'

                    MDStackLayout:
                        orientation: 'tb-lr'
                        padding: [dp(15), 0, dp(15), 0]
                        spacing: dp(20)

                        FrogSeparateOptionTextField:
                            id: auxiva_n_src
                            text: '1'
                            hint_text: 'number of sound source.'
                            helper_text: 'default: number of channel'

                        FrogSeparateOptionTextField:
                            id: auxiva_n_iter
                            text: '20'
                            hint_text: 'number of iteration.'
                            helper_text: 'default: 20'

                MDScreen:
                    name: 'fastmnmf'

                    MDStackLayout:
                        orientation: 'tb-lr'
                        padding: [dp(15), 0, dp(15), 0]
                        spacing: dp(20)

                        FrogSeparateOptionTextField:
                            id: fastmnmf_n_src
                            text: '1'
                            hint_text: 'number of sound source.'
                            helper_text: 'default: number of channel'

                        FrogSeparateOptionTextField:
                            id: fastmnmf_n_iter
                            text: '30'
                            hint_text: 'number of iteration.'
                            helper_text: 'default: 30'

                        FrogSeparateOptionTextField:
                            id: fastmnmf_n_components
                            text: '4'
                            hint_text: 'number of components in the non-negative spectrum.'
                            helper_text: 'default: 4'

        Button:
            size_hint_x: 1
            text: 'separate'
            on_press:
                root.separate()
                root.parent_tab.ids.screen_manager.current = 'select'

<FrogSelect>:
    BoxLayout:
        orientation: 'horizontal'
        size: root.size

        MDStackLayout:
            id: stack_sep
            orientation: 'lr-tb'
            size_hint_x: 2
            md_bg_color: 1, 1, 1, .8

        Button:
            size_hint_x: 1
            text: 'select'
            on_press:
                root.select()

<FrogAnalysis>:
    BoxLayout:
        orientation: 'vertical'
        size: root.size

        ScrollView:
            do_scroll_y: False

            MDBoxLayout:
                id: box_signals
                orientation: 'horizontal'
                size_hint_y: 1
                adaptive_width: True
                md_bg_color: 1, 1, 1, .8

        MDBoxLayout:
            size_hint_y: 2
            orientation: 'horizontal'

            MDBoxLayout:
                id: box_hist
                orientation: 'vertical'
                padding: dp(20), dp(10)
                md_bg_color: 1, 1, 1, .8

                MDBoxLayout:
                    orientation: 'horizontal'
                    spacing: dp(15)
                    adaptive_height: True

                    MDIcon:
                        icon: 'poll'
                        theme_text_color: 'ContrastParentBackground'
                        font_size: dp(25)

                    MDLabel:
                        font_style: 'H5'
                        theme_text_color: 'ContrastParentBackground'
                        text: 'ヒストグラム'

            ScrollView:
                do_scroll_x: False

                ScrollableTreeView:
                    id: result_treeview
                    root_options: {'text': 'combinations', 'font_size': '15sp'}
